<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
<script src="game.json"></script>
<script>
function readGameJson(url, callback)
{
	/*
	$.ajax({
	  url: url,
	  dataType: 'json',
	  success: function(result){
	    //alert("token recieved: " + result.token);
	    callback(result);
	  },
	  error: function(request, textStatus, errorThrown) {
	    alert(textStatus);
	  },
	  complete: function(request, textStatus) { //for additional info
	    //alert(request.responseText);
	    //alert(textStatus);
	  }
	});
*/
	callback(json);
	//alert(json.length);
}

function print(ch)
{
	var box = $("textarea#chatBox");
	box.val(box.val() + String(ch));
	//alert(box.value);
	//var chrStr = String(ch);
	//alert(chrStr);
	//box.value = box.value + chrStr;
	//alert(box.value);
}

var currNode;

var lines;
var currLineIndex;
var currLineCharIndex;

var charDelayInMs = 40;
var lineDelayInMs = 1250;
var choiceDelayInMs = 800;

function resetLines()
{
	currLineCharIndex = 0;
	currLineIndex = 0;
	lines = [];
}

var displayLinesCallback;

function displayLines()
{
	//alert(currLineIndex);
	var line = lines[currLineIndex];
	var ch = line.charAt(currLineCharIndex++);
	//alert(line);
	//alert(ch);
	print(ch);
	if (currLineCharIndex < line.length)
	{
		// loop through this line's characters
		setTimeout(displayLines, charDelayInMs);
	}
	else
	{
		// end of line
		print('\n');
		currLineCharIndex = 0;
		currLineIndex++;
		if (currLineIndex < lines.length)
		{
			setTimeout(displayLines, lineDelayInMs);
		}
		else
		{
			//displayLinesCallback();
			setTimeout(displayLinesCallback, lineDelayInMs);
		}
	}
}

function getUserInput()
{
	alert('done');
}

var buttons;
var buttonIndex;

function showButtons()
{
	if (buttonIndex < buttons.length)
	{
		buttons[buttonIndex++].show();
		setTimeout(showButtons, choiceDelayInMs);
	}
}

function hideButtons()
{
	buttons = [ $("#c0"), $("#c1"), $("#c2") ];
	for (var i=0; i < buttons.length; i++) {
		buttons[i].hide();
	}
}

function displayChoices()
{
	buttons = [ $("#c0"), $("#c1"), $("#c2") ];
	buttonIndex = 0;
	showButtons();
}


function displayNode(node)
{
	resetLines();
	lines = node.lines;
	displayLinesCallback = displayChoices;
	displayLines();
}

function loadChoices(node)
{
	$("#c0").html(node.choices[0].text);
	$("#c1").html(node.choices[1].text);
	$("#c2").html(node.choices[2].text);
}

$(document).ready(function() {
	readGameJson("game.json", function(data) {
		hideButtons();
		currNode = data[0];
		loadChoices(currNode);
		displayNode(currNode);
	});
});

</script>
</head>
<body>
<h1>Chattr Client</h1>
<h2>Msg from DefinitelyNotABot1337</h2>
<textarea rows="30" cols="80" id="chatBox"></textarea>
<div id="buttonDiv">
<button id="c0" value="0"></button>
<button id="c1" value="1"></button>
<button id="c2" value="2"></button>
</div>
</body>
</html>